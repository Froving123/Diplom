(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[769],{1788:function(e,t,r){Promise.resolve().then(r.t.bind(r,1127,23)),Promise.resolve().then(r.bind(r,3364)),Promise.resolve().then(r.bind(r,181))},7368:function(e,t,r){"use strict";r.d(t,{a:function(){return i}});var s=r(3827),n=r(3744),o=r.n(n);let i=e=>(0,s.jsx)("div",{onClick:e.close,className:"".concat(o().overlay," ").concat(e.isOpened&&o()["overlay_is-opened"])})},5838:function(e,t,r){"use strict";r.d(t,{G:function(){return i}});var s=r(3827),n=r(4487),o=r.n(n);let i=e=>(0,s.jsxs)("div",{className:"".concat(o().popup," ").concat(e.isOpened&&o()["popup_is-opened"]),children:[(0,s.jsx)("button",{onClick:e.close,className:o().close,children:(0,s.jsx)("svg",{className:o()["close-icon"],xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 25",children:(0,s.jsx)("path",{fill:"#7E8292",d:"M15.3321 18.34c.04.0667.06.1533.06.26 0 .0933-.0467.1867-.14.28-.08.08-.18.12-.3.12h-4.5c-.36 0-.63332-.1533-.81999-.46l-1.74-2.68-1.66 2.68c-.18667.3067-.46.46-.82.46h-4.36c-.120001 0-.226667-.04-.320001-.12-.08-.0933-.12-.1867-.12-.28 0-.1067.02-.1933.06-.26l4.200001-6.5-3.78-6.18c-.04-.08-.06-.16667-.06-.26s.04-.18.12-.26c.09333-.09333.2-.14.32-.14h4.34c.37333 0 .65333.16667.84.5l1.4 2.44 1.52-2.44c.18667-.33333.46669-.5.83999-.5h4.14c.12 0 .22.04667.3.14.0933.08.14.17333.14.28 0 .09333-.02.17333-.06.24l-3.86 6.12 4.26 6.56Z"})})}),(0,s.jsx)("div",{className:o().content,children:e.children})]})},181:function(e,t,r){"use strict";r.r(t),r.d(t,{Shopping_cart:function(){return _}});var s=r(3827),n=r(4090),o=r(1748),i=r(3105),c=r(3033),a=r.n(c);let _=()=>{let[e,t]=(0,n.useState)([]),[r,c]=(0,n.useState)(0);(0,n.useEffect)(()=>{let e=i.I.onAuthStateChanged(e=>{e?_(e.uid):(t([]),c(0))});return()=>e()},[]);let _=async e=>{let r=(0,o.iH)(i.db,"product"),s=(0,o.IO)(r,(0,o.g2)("userId"),(0,o.EW)(e));try{await new Promise(e=>{(0,o.jM)(s,r=>{if(r.exists()){let s=[];r.forEach(e=>{s.push({id:e.key,...e.val(),quantity:e.val().quantity||1})}),t(s),p(s),e()}else console.log("Данные не найдены"),c(0),e()})})}catch(e){console.error("Ошибка при получении данных: ",e)}},l=async r=>{try{await (0,o.Od)((0,o.iH)(i.db,"product/".concat(r)));let s=e.filter(e=>e.id!==r);t(s),p(s)}catch(e){console.error("Ошибка при удалении товара: ",e)}},d=async(r,s)=>{try{await (0,o.Vx)((0,o.iH)(i.db,"product/".concat(r)),{quantity:s});let n=e.map(e=>e.id===r?{...e,quantity:s}:e);t(n),p(n)}catch(e){console.error("Ошибка при обновлении количества товара: ",e)}},p=e=>{c(e.reduce((e,t)=>e+t.price*t.quantity,0))};return(0,s.jsx)("div",{className:a().shopping_cart,children:e.length>0?(0,s.jsx)("div",{className:a().ul_product,children:e.map(e=>(0,s.jsxs)("div",{className:a().product,children:[(0,s.jsxs)("div",{className:a().product_content,children:[(0,s.jsxs)("p",{className:a().product_description,children:[e.name," x ",e.quantity]}),(0,s.jsxs)("div",{className:a().quantity_controls,children:[(0,s.jsx)("p",{className:a().product_description,children:parseInt(e.price)*e.quantity?(parseInt(e.price)*e.quantity).toFixed(0)+"₽":""}),(0,s.jsxs)("div",{className:a().quantity_buttons,children:[(0,s.jsx)("button",{className:a().button_quantity,onClick:()=>d(e.id,e.quantity+1),children:"+"}),(0,s.jsx)("button",{className:a().button_quantity,onClick:()=>d(e.id,e.quantity-1),disabled:e.quantity<=1,children:"-"})]})]})]}),(0,s.jsx)("button",{onClick:()=>l(e.id),className:a().button_remove,children:(0,s.jsx)("p",{className:a().remove_text,children:"Удалить"})})]},e.id))}):(0,s.jsx)("ul",{className:a().empty_product,children:(0,s.jsx)("p",{className:a().empty_description,children:"В корзине нет товаров"})})})}},3364:function(e,t,r){"use strict";r.r(t),r.d(t,{Shopping_cart_button:function(){return m}});var s=r(3827),n=r(4090),o=r(1748),i=r(9479),c=r.n(i),a=r(3105),_=r(7368),l=r(5838),d=r(9626),p=r.n(d);let u=e=>{let[t,r]=(0,n.useState)({address:""}),[i,c]=(0,n.useState)(""),[_,l]=(0,n.useState)([]),[d,u]=(0,n.useState)(0);(0,n.useEffect)(()=>{let e=a.I.onAuthStateChanged(e=>{e?m(e.uid):(l([]),u(0))}),t=(0,o.jM)((0,o.iH)(a.db,"product"),()=>{let e=a.I.currentUser;e&&m(e.uid)});return()=>{e(),t()}},[]);let m=async e=>{try{let t=(0,o.iH)(a.db,"product"),r=(0,o.IO)(t,(0,o.g2)("userId"),(0,o.EW)(e));await new Promise(e=>{(0,o.jM)(r,t=>{if(t.exists()){let r=[];t.forEach(e=>{let t=parseInt(e.val().price)||0,s=parseInt(e.val().quantity)||1;r.push({id:e.key,...e.val(),price:t,quantity:s})}),l(r),h(r),e()}else l([]),u(0),console.log("Данные не найдены"),e()})})}catch(e){console.error("Ошибка при получении данных: ",e)}},h=e=>{u(e.reduce((e,t)=>e+parseInt(t.price)*t.quantity,0))},f=async()=>{try{let e=a.I.currentUser;if(e){let t=(0,o.iH)(a.db,"product"),r=(0,o.IO)(t,(0,o.g2)("userId"),(0,o.EW)(e.uid));await new Promise(e=>{(0,o.jM)(r,t=>{if(t.exists()){let r={};t.forEach(e=>{r["product/".concat(e.key)]=null});let s=(0,o.iH)(a.db);(0,o.Vx)(s,r).then(()=>{console.log("Все записи пользователя из базы данных 'product' удалены"),e()})}else console.log("Данные не найдены"),e()})})}}catch(e){console.error("Ошибка при удалении записей: ",e)}},y=async s=>{if(s.preventDefault(),t.address)try{let s=a.I.currentUser;if(s){let n=(0,o.VF)((0,o.iH)(a.db,"delivery")).key,i={address:t.address,payment:t.payment,userId:s.uid,price:d};await (0,o.t8)((0,o.iH)(a.db,"delivery/".concat(n)),i),r({address:""}),c(""),e.close(),await f(),window.location.reload(),alert("Ваш заказ принят")}}catch(e){console.error("Ошибка при добавлении документа: ",e)}else c("Пожалуйста, заполните поле"),setTimeout(()=>{c("")},5e3)};return(0,s.jsxs)("form",{className:p().form,children:[(0,s.jsx)("h2",{className:p().form__title,children:"Доставка"}),(0,s.jsxs)("div",{className:p().form__fields,children:[(0,s.jsxs)("label",{className:p().form__field,children:[(0,s.jsx)("span",{className:p()["form__field-title"],children:"Адрес"}),(0,s.jsx)("input",{className:p()["form__field-input"],type:"street",value:t.address,placeholder:"Ул.Мира 156, кв.45",onChange:e=>r({...t,address:e.target.value})})]}),(0,s.jsxs)("label",{className:p().form__field,children:[(0,s.jsx)("span",{className:p()["form__field-title"],children:"Способ оплаты"}),(0,s.jsxs)("select",{className:p()["form__field-input"],value:t.payment,onChange:e=>r({...t,payment:e.target.value}),children:[(0,s.jsx)("option",{disabled:!0,selected:!0,children:"Выберите способ оплаты"}),(0,s.jsx)("option",{children:"Наличными при получении"}),(0,s.jsx)("option",{children:"Картой при получении"})]})]}),(0,s.jsxs)("div",{className:p().order,children:[(0,s.jsx)("p",{className:p().order_content,children:"Стоимость заказа"}),(0,s.jsxs)("p",{className:p().order_content,children:[d,"₽"]})]})]}),i&&(0,s.jsx)("p",{className:p().error_message,children:i}),(0,s.jsx)("div",{className:p().form__actions,children:(0,s.jsx)("button",{onClick:y,className:p().form__submit,children:"Заказать"})})]})},m=()=>{let[e,t]=(0,n.useState)([]),[r,i]=(0,n.useState)(0),[d,p]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=a.I.onAuthStateChanged(e=>{e?m(e.uid):(t([]),i(0))});return()=>e()},[]);let m=async e=>{let r=(0,o.iH)(a.db,"product"),s=(0,o.IO)(r,(0,o.g2)("userId"),(0,o.EW)(e));try{(0,o.jM)(s,e=>{if(e.exists()){let r=[];e.forEach(e=>{let t=parseInt(e.val().price)||0,s=parseInt(e.val().quantity)||1;r.push({id:e.key,...e.val(),price:t,quantity:s})}),t(r),h(r)}else t([]),i(0)})}catch(e){console.error("Ошибка при получении данных: ",e)}},h=e=>{i(e.reduce((e,t)=>e+(parseInt(t.price)||0)*(parseInt(t.quantity)||1),0))},f=()=>{p(!1)};return(0,s.jsxs)("div",{className:c().shopping_cart_button,children:[e.length>0?(0,s.jsxs)("button",{className:c().order_button,onClick:()=>{p(!0)},children:[(0,s.jsx)("p",{className:c().order_content,children:"Заказать"}),(0,s.jsxs)("p",{className:c().order_content,children:[r.toFixed(0),"₽"]})]}):"",(0,s.jsx)(_.a,{isOpened:d,close:f}),(0,s.jsx)(l.G,{isOpened:d,close:f,children:(0,s.jsx)(u,{close:f})})]})}},3105:function(e,t,r){"use strict";r.d(t,{I:function(){return c},db:function(){return a}});var s=r(6142),n=r(2730),o=r(1748);let i=(0,s.ZF)({apiKey:"AIzaSyDO_-hjElfDwtU1ESVRSFt8hZJ7IIMwlno",authDomain:"best-rest-99119.firebaseapp.com",databaseURL:"https://best-rest-99119-default-rtdb.europe-west1.firebasedatabase.app",projectId:"best-rest-99119",storageBucket:"best-rest-99119.appspot.com",messagingSenderId:"90112321750",appId:"1:90112321750:web:2be2a6ea307df81f7b8177"}),c=(0,n.v0)(i),a=(0,o.N8)(i)},1127:function(e){e.exports={cart:"Cart_cart__WA5qe"}},9626:function(e){e.exports={form:"DeliveryForm_form__4dbC5",form__title:"DeliveryForm_form__title__bmid7",form__fields:"DeliveryForm_form__fields__Qbm39",form__field:"DeliveryForm_form__field__HHIpP","form__field-title":"DeliveryForm_form__field-title__z_ZFu","form__field-input":"DeliveryForm_form__field-input__AQ_bq",form__actions:"DeliveryForm_form__actions____vdd",order:"DeliveryForm_order__Mym0G",order_content:"DeliveryForm_order_content__9HDdM",form__submit:"DeliveryForm_form__submit__XnN9V",form__reset:"DeliveryForm_form__reset__QiYrw",form__transition:"DeliveryForm_form__transition__GsOSp",error_message:"DeliveryForm_error_message__VBoyi"}},3744:function(e){e.exports={overlay:"Overlay_overlay__87APJ","overlay_is-opened":"Overlay_overlay_is-opened__QKW4v"}},4487:function(e){e.exports={popup:"Popup_popup__lJxRt","popup_is-opened":"Popup_popup_is-opened__R8NFO",close:"Popup_close__efpry","close-icon":"Popup_close-icon__QfKYp"}},3033:function(e){e.exports={shopping_cart:"Shopping_cart_shopping_cart__C97dj",ul_product:"Shopping_cart_ul_product__vJXZs",product:"Shopping_cart_product__2_icS",product_content:"Shopping_cart_product_content__8nnn5",product_description:"Shopping_cart_product_description__aCDUV",quantity_controls:"Shopping_cart_quantity_controls__AeiIW",quantity_number:"Shopping_cart_quantity_number__6XGaF",quantity_buttons:"Shopping_cart_quantity_buttons__uTCUy",button_quantity:"Shopping_cart_button_quantity__Mwr5V",button_remove:"Shopping_cart_button_remove__iN166",remove_text:"Shopping_cart_remove_text__499iC",empty_product:"Shopping_cart_empty_product__rOt_y",empty_description:"Shopping_cart_empty_description__3Hl1T"}},9479:function(e){e.exports={shopping_cart_button:"Shopping_cart_button_shopping_cart_button__Fr7N4",order_button:"Shopping_cart_button_order_button__X6pF0",order_content:"Shopping_cart_button_order_content__SSsm3"}}},function(e){e.O(0,[481,150,168,971,69,744],function(){return e(e.s=1788)}),_N_E=e.O()}]);